<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Product</title>
  <link rel="stylesheet" href="/style.css" />
    <script>
        function updateSize() {
            const selectedTypeId = document.getElementById("type").value;
            const sizeContainer = document.getElementById("size");
            const hiddenSize = document.getElementById("hiddenSize");

            if (selectedTypeId === '1') { // Check if the selected type is 'clothing'
                sizeContainer.style.display = "block";
                hiddenSize.disabled = true;
            } else {
                sizeContainer.style.display = "none";
                hiddenSize.disabled = false;
                hiddenSize.value = "-";
            }
        }
    </script>
</head>

<body>
  <header th:insert="blocks/navbar :: navbar"></header>
  <h2>Add a New Product</h2>
  <div>
    <form th:object="${product}" class="form-input" th:action="@{/addproduct}" method="post">
      <label for="name">Name:</label><br />
      <input type="text" id="name" th:field="*{name}" />
      <p th:if="${#fields.hasErrors('name')}" class="error-message" th:errors="*{name}">
        Name Error
      </p>
      <br />
      
      <!-- Kaj comment: This is the old form without Type entity.
      After writing and testing some n/ew codes, I think th/is is a better solution.
      
      Note that in the n/ew codes, the saving of newly added product was accepted.
      
      TODO: Code complains that does not find and cant save 
      neither type nor size from Product.
      
      Check: how we can save newly added type and type.size 
      when Type is now its own entity?
    
      Alternatively: how should th -tags (like th:each, :value, :field) 
      rewritten, when we want to refer to Type -entity, not to the Product? 		 

      <label for="type">Type:</label><br />
      <select id="type" th:field="*{type}" required onchange="updateSize()">
        <option value="">Select Type</option>
        <option value="clothing">Clothing</option>
        <option value="food">Food</option>
        <option value="toy">Toy</option>
      </select>
      <br />

      <div id="size" style="display: none">
        <label for="size">Size:</label><br />
        <select id="size" th:field="*{type.size}">
          <option value="S">S</option>
          <option value="M">M</option>
          <option value="L">L</option>
        </select>
      </div>
      <input type="hidden" id="hiddenSize" name="size" value="No size" />

      -->
      
      <!-- Kaj comment: This is the current form with newly created Type entity.
      This has been remoddeled from below example of Manufacturer.
      
      However, its has an depedencie error to DogstoreApplication.
      Meaning, it borrows values directly from DogstoreApplications` types 
      such as smallCloth, largeCloth, chickenFood, etc.
      
      We want have an invariant, sta/tic list of types (clothing, food, toy) 
      and size (-, S, M, L) without duplicate values, like in the older versions.
      
      
      
      It has typecategory and typesize labels.
      <label for="typecategory">Type:</label><br />
      <select id="typecategory" th:field="*{type} " required>
        <option value="" >Select a type</option>
        <option th:each="type : ${types}" th:value="${type.id}" th:text="${type.category}">
        </option>
      </select>
      <p th:if="${#fields.hasErrors('type')}" class="error-message" th:errors="*{type}">
        Type Error
      </p>
      <br />
      
      <label for="typesize">Size:</label><br />
      <select id="typesize" th:field="*{type} " required>
        <option value="" >Select a size</option>
        <option th:each="type : ${types}" th:value="${type.id}" th:text="${type.size}">
        </option>
      </select>
      <p th:if="${#fields.hasErrors('type')}" class="error-message" th:errors="*{type}">
        Size Error
      </p>
      <br />
      
      -->

            <label for="type">Type:</label><br />
            <select id="type" th:field="*{type}" required onchange="updateSize()">
                <option value="">Select Type</option>
                <option th:each="type : ${types}" th:value="${type.id}" th:text="${type.category}"></option>
            </select>
            <br />

            <div id="size" style="display: none">
                <label for="sizeSelect">Size:</label><br />
                <select id="sizeSelect" th:field="*{size}">
                    <option value="S">S</option>
                    <option value="M">M</option>
                    <option value="L">L</option>
                </select>
            </div>
            <input type="hidden" id="hiddenSize" th:field="*{size}" value="-" />


      <label for="color">Color:</label><br />
      <input type="text" id="color" th:field="*{color}" />
      <p th:if="${#fields.hasErrors('color')}" class="error-message" th:errors="*{color}">
        Color Error
      </p>
      <br />

      <label for="price">Price:</label><br />
      <input type="number" id="price" th:field="*{price}" min="0" step="0.01" />
      <p th:if="${#fields.hasErrors('price')}" class="error-message" th:errors="*{price}">
        Price Error
      </p>
      <br />

      <label for="quantity">Quantity:</label><br />
      <input type="number" id="quantity" th:field="*{quantity}" min="0" step="1" />
      <p th:if="${#fields.hasErrors('quantity')}" class="error-message" th:errors="*{quantity}">
        Quantity Error
      </p>
      <br />

      <label for="manufacturer">Manufacturer:</label><br />
      <select id="manufacturer" th:field="*{manufacturer} " required>
        <option value="" >Select a manufacturer</option>
        <option th:each="manufacturer : ${manufacturers}" th:value="${manufacturer.id}" th:text="${manufacturer.name}">
        </option>
      </select>
      <p th:if="${#fields.hasErrors('manufacturer')}" class="error-message" th:errors="*{manufacturer}">
        Manufacturer Error
      </p>
      <br />

      <input type="submit" value="Add" />
    </form>
    <a href="/listproducts">Back to Products</a><br />
    <a href="/index">Back to Home</a>
  </div>

  <footer th:insert="blocks/navbottom :: navbottom"></footer>
</body>
</html>